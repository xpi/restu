<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>开单页面</title>

    <script src="/js/vendor/jquery.js"></script>
          <script src="/js/foundation.min.js"></script>

    <link rel="stylesheet" href="/css/foundation.css" />
    <link rel="stylesheet" href="/css/app.css" />
    <script src="/js/vendor/modernizr.js"></script>
  </head>
  <body>
    <nav class="top-bar" data-topbar role="navigation">
      <ul class="title-area">
        <li class="name">
          <h1><a href="#">开单页面</a></h1>
        </li>
      </ul>
    </nav>

    <div class="row ">
        <form id="changeTable">
          <br>
          
          <div class="row">

           <div class="large-10 small-10 large-centered  small-centered  columns">
                  <span id="tableNum" class="large radius button secondary" style="font-size:80px;"></span>

                  <span id="orderup" class="large radius button " style="font-size:80px;">开单</span>
           </div>   
          
          </div>
        </form>
    </div>     
    <script>
      $(document).foundation();
    </script>
  </body>
</html>

    <script>
      $(document).foundation();
      var storage = window.localStorage;
      var currentNum = storage["table_num"];
      if(!currentNum){
        window.location.href="/table/init/";
      }
      $.get("/table/"+currentNum,function(data){
        if(data.length==0){
          window.location.href="/table/init/";
          return;
        }
        init();
      });

       var init = function(){
          $("#tableNum").text(currentNum+"号");
          $.get("/table/"+currentNum,function(data){
            if(!data[0].bill_id){
               $("#orderup").click(function(){
                    $.post("/bill/add/"+currentNum,function(res){
                      storage["bill_id"]=res.bill_id;
                      storage["table_num"]=currentNum;                    
                      window.location.href="/customer?table_num="+currentNum+"&bill_id="+data.bill_id;
                    });
                });
            }else{
              window.location.href="/customer?table_num="+currentNum+"&bill_id="+data[0].bill_id;
            }
          });
          
       }  


    </script>
  